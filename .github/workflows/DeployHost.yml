name: Auto Deploy to Shared Host ðŸš€

on:
  workflow_call:

jobs:
  checkout:
    name: To the moon ðŸš€ðŸŒ•
    runs-on: ubuntu-latest
    steps:
      - name: Checkout ðŸ›’
        uses: actions/checkout@v4

      - name: Set up Node.js ðŸ“¦
        uses: actions/setup-node@v3
        with:
          node-version: '14.x'

      - name: Install dependencies ðŸ“¥
        run: |
          npm install
          npm run build

      - name: Set up Composer ðŸ“¦
        uses: ramsey/composer-install@v2
        with:
          composer-options: --no-dev --no-interaction --no-progress --no-suggest --optimize-autoloader

      - name: Sync files ðŸ”„
        uses: SamKirkland/FTP-Deploy-Action@4
        with:
          ftp-server: ${{ secrets.FTP_SERVER }}
          ftp-username: ${{ secrets.FTP_USERNAME }}
          ftp-password: ${{ secrets.FTP_PASSWORD }}
          local-dir: ./
          server-dir: /public_html
          args: --delete
          exclude: .git*
          state-name: ${{ github.event.pull_request.number }}
          log-level	: verbose